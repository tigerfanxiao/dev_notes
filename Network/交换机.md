
### 冲突域
交换机的每一个接口都是一个冲突域. 

### 广播域
如果不做特殊的隔离, 默认情况下, 交换机的所有接口都在一个广播域内. 
我们也可以认为一个网段的内部就是一个广播域, 在这个网段中的有多台主机. 这些主机之间的通信可以通过交换机的二层通信完成. 
路由器主要负责网段到网段之间的通信. 所以网段也称为前缀. 
交换机使用的通信方式有单播和广播两种. 单播就是查找自己的mac地址表. 如果有记录则从对应的接口转发出去. 如果没有记录, 则向其余接口泛洪.

### 网关
网关是面向广播域说的, 在主机设备上设置了网关. 交换机才能把帧转发给网关路由器

# MAC地址
mac地址是48bit. 每一个16进制位=4个二进制位. 一般是两个16进制位, 即8个二进制位为即一个字节为一组. 一共分48/8 = 6组

mac地址有单薄, 组播和广播. 
* 广播的mac地址为 FF:FF:FF:FF
* 组播的mac地址第一个字节的最后一个bit位为1
* 单播的mac地址的第一个字节的最后一个bit位为0

### mac 地址表
交换机上有mac地址表. 交换机通过收到的帧的源mac地址进行学习. 
查询 mac 地址表有两种类型, 一个是 static, 一个是 dynamic.  一般认为 static 是手工配置的, dynamic 则是学到的

```shell
display mac-address
```


* 交换机自己可以不需要mac地址
* 在一个广播域中的设备相互通信, 本质上使用mac地址就够了
* 主机上配置网关, 从二层的角度看, 这个网关的mac地址是路由器的借口. 当中间的交换机收到这个二层帧的时候, 因为目的mac地址不是自己, 不会解封装, 而是查询自己的mac地址表, 从连接着路由器的接口转发出去. 
* 只有当mac地址是自己时, 设备才会对帧进行解封装. 同理, 如果解封装之后发现ip地址是自己, 就进一步解封装, 查看载荷. 如果ip的目的地址不是自己, 则查询路由表, 找到下一条的mac地址, 重新进行封装. 然后从出接口转发出去.

### 交换机的部署方式

如果是小型企业网络, 两层就可以搞定. 接入层的交换机连接的是主机. 然后多个接入层直接连接核心层

如果是中大型企业网络, 则是三层. 每一层楼的主机连接一个接入层交换机. 每一栋楼的交换机连接在一个汇聚交换机上. 每一个汇聚交换机连接到核心交换机上. 一般核心交换机放在核心机房. 

# 最佳实践

汇聚层的交换机， 在左右两边创建相同的vlan， 主机从一侧切换到另一侧就不要创建了。

# 交换机的参数
## 交换机包转发机制
交换机处理包转发用的是接口的ASIC芯片, 而不是交换机的CPU. 这种转发方式也称为硬件转发. 
路由器转发报文的方式是通过CPU计算的. 所以在流量大的时候, CPU的占用高. 防火墙比路由器更贵的原因就在于, 它作为出口设备往往需要比CPU更高的包转发率. 所以硬件上CPU的能力要求更高. 

一台交换机在流量慢速的情况下, CPU的占用率一般在10%-20%. 所以一般情况下交换机不会因为CPU沾满而卡死. 交换机出现CPU占用过高的情况, 一般是网络中出现了环路, 造成了网络风暴. 处理的办法一般物理上拔线. 因为此时CPU占满, 多半无法远程登陆了. 


### 包转发率 Forwarding Performance
一个以太网帧中, 数据最小是64Bytes, 每一个数据部分加上帧头8Bytes, 12Byte帧间隙. 也就是说一个以太网帧的最小是 `64 + 8 + 12 = 84Bytes = 8*8 = 672 bit`

一个千兆网口(1GE)的速度是 1000Mbps 也就是说1秒钟内传输1000Mbit, 换算成帧的数量就是
`1000M / 672 = 1.488Mpps` 也就是说有1百多万个报文
一个百兆网口(100M)的速度是100Mbps, 包转发率是0.1488Mpps
一个万兆网口(10GE)的速度是10Gbps, 包转发率是14.88Mpps 也就是1千多万个报文

对比路由器的包转发率的话, 每秒钟转发可能不到一万

### 下载速度
100M带宽 = 100Mbps 
下载速度是用字节计算的. 所以 100Mbps/ 8 = 12.5MBps 

## 交换容量

一个24个 百兆口, 2个千兆WAN口的全双工交换机的交换容量是
`23 * 100 * 2 + 2 * 1000 M * 2 = 8.8Gbps`
注意: 
1. 上下行的端口都要考虑
2. 全双工的接口, 要乘以二

## 背板带宽
一般说背板带宽指的框式交换机. 也就说机框的背面有很多插槽. 每个插槽可以插一个交换板. 
然后有一个板子去把所有的交换板连接起来. 这个板子就是背板. 背板带宽的大小决定了这个框式交换机上能插多少块满速运行的交换板. 
每一块交换板的交换容量加起来如果小于背板带宽, 那么就称这个交换机是线速转发的. 
注意: 非框式交换机, 比如1U的24口, 48口的交换机, 一般没有交换板插槽. 端口数是固定的. 所以只要看交换机的交换容量就行. 不存在背板带框这个参数

PoE交换机

# 交换机选型

## 华为
![[Pasted image 20230928100934.png]]
命名规则
S5735中的S表示交换机
最末尾的A1中的A表示交流点， 如果是直流电则用DC表示
L48和S48的区别在于S表示是面向企业的产品， 性能和容量更好。 当前的S系列支持双电源模块
L48中48表示下行接口数量
P4S中的P表示PoE
4S表示4个上行GE口， 如果是4X表示4个上行10GE SFP+口



