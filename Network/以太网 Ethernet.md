# 以太网线材

### 网线

网线分为 5 类, 6 类, 7 类
一般说的千兆网络, 指的就是超 5 类网线
双绞线:  传输距离一般是 100 米
STP: 屏蔽双绞线
UTP: 非屏蔽双绞线

网线速度: 
ethernet: 10M
FastEthernet: 100M
gigaEthernet: 1000M

### 接口标准

网线上的水晶头: RJ45
一般的电话线: RJ11
MDI: 自动调整线序的协议, 一般千兆口都必须支持

### 单双工

双工模式
双工 full duplex
千兆网口一般是全双工, 因为半双工传输距离短

半双工 half duplex
类似对讲机, 或者总线模式. 没有控制机制, 需要 CSMA/CD

单工
类似收音机

以太网技术基于 CSMA/CD 带冲突检测的, 载波监听, 多路检测的广播型网络
CSMA/CD:

- CS 载波监听, 在发信号之前听一听
- MA: 多路访问
- CD: 冲突检验, 一旦发生冲突都闭嘴

### 光纤

接口类型
SC 大方头 已经退出市场了
LC 小方头 现在设备常用
FC 圆头 多用于 ODF 跳纤架
熔纤盒

光缆的芯: 一般是有 16, 24, 32 三种. 芯越多可以分出的尾纤也越多
熔纤盒: 将光缆和尾纤接起来的工具
分光器: 将光缆分成多个光纤的设备. 一般有 1:16 和 1:32 两种
接续盒: 连接光缆的, 远距离传输时增强光信号的装置
波长: 一般是 1310 和 1550
光功率: 单位为 dB, 量级一般是 13dB. 一般使用光衰来控制光功率
光模块: 
SFP: 1G, 收发各一根. 收发波长一样, 1310 或者 1550
SFP+ 10G
QSFP: 40G光纤
QSFP28: 100G光纤
PON : 收发都在一根纤. 收到波长 1310, 发的波长 1550. 通常用于连接到小区的设备
光跳纤: 当两台设备需要的尾纤不一样时, 需要做光跳纤转接
光纤分类:

- 多模 multi-mode 橙色, 发光二极管(LED)作为信号, 短距离, 工艺要求低
- 单模 single mode 黄色, 激光作为信号源, 长距离, 工艺要求高

法兰头: 连接两路光纤, 中间是玻璃
ODF 架: 一般在数据中心中用于设备之间的互联

### Hub 总线型网络

- 早期的以太网是总线结构的, 用 hub 来组网.
- 同一个时刻, 只能有一台设备发送或者接受数据.
- 此时, 设备属于半双工的状态. 其他的用户会监听网络上是否有人发言, 如果有, 则退避一段时间.
- 当用户增加时, 每个主机的发送时间越来越少. 可用带宽也越来越少.
- 基于物理信号转发(01), 因为不能成帧, 不知道目的地址, 所以所有数据通过泛洪方式传播

### CSMA/CD 机制

在一个共享介质中去检测和避免冲突的发生. 其特征有

1. 先听后发
2. 边听边发
3. 随机再发

### 交换机

- 每个端口都有自己的缓存, 实现在一个接口同时收发. 交换机是矩阵型的结构, 不是总线接口
- 不再做电信号的处理, 而是可以还原成数据帧, 可以从指定端口出去. 不需要泛洪所有的帧.
- 交换机可以隔离冲突域. 每个接口都是一个冲突域. 但是并不隔离广播. 所有接口属于同一个广播域
- 在交换机存在的情况下, 在全双工模式下, 不需要 CSMA/CD 机制, 默认是关闭的

> 如果在交换机下面接 Hub, 接口会自动协商为半双工, 启动 CSMA/CD 机制

交换机单个接口现在能做到 100G 带宽, 未来会后 400G

### 以太网帧格式

以太网有两种帧格式 Ethernet || 和 IEEE 802.3

Ethernet ||
| D.MAC | S.MAC | Type | 用户数据 | FCS |

- Type 字段 0806 ARP, 0800 IPv4

IEEE 802.3
|D.MAC| S.MAC| Length | LLC | SNAP | 用户数据 | FCS |

- SNAP = | Org Code | Type |

### MAC 地址

MAC 地址 6 个字节组成, 一共是 `6 * 8 = 48 bit`
MAC 地址可以分单播, 组播, 广播

1. 单播 MAC 地址: 第一个字节的最后一位是 0
2. 组播 MAC 地址: 第一个字节的最后一位是 1
3. 广播 MAC 地址: 所有位都是 1

### 交换机怎样成帧

帧发送前, 网卡会额外在帧头添加帧前导符, 标识一个帧的起始. 让接受设备准备开始接受一个帧

- 以太网的前导符 64bit, 前 56bit 是 010101... , 后 8 个 bit 01010111
- 每个帧都有前导符, 可以理解为两个前导符之间的内容, 就是一个帧

### 交换机怎样转发数据帧

- 交换机收到数据帧之后, 学习源 mac 地址. 将源 mac 地址和收到的接口绑定, 称为 mac 地址表. 在 mac 地址表看目标 mac 地址在不在. 在则从端口转发出去, 如果查不到这个接口, 则进行泛洪, 则个就是未知单播帧
- MAC 地址表: mac 地址 --> 接口
- 交换转发数据帧的行为

  1.  泛洪 Flooding 将一个接口收到的数据, 发给剩余的接口
  2.  转发 forwarding 将一个接口的数据发给一个特定的接口
  3.  丢弃 Discarding 发现源 mac 和目的 mac 对应同一个接口时

- 交换机默认处理组播也是泛洪处理. 也有特殊的机制, 发送给组播的接口
- 当交换机收到的帧, 目的 mac 地址是收到帧的接口, 会丢弃. 往往是有环路

### MAC 地址表

- MAC 地址表老化时间默认是 300 秒=5 分钟
- 当网线拔出, 或者接口损坏时, 只要没有电信号时, MAC 地址表中的条目会立即老化掉
- 当交换机收到帧时, 如果源 mac 地址表项在 mac 地址表中, 则刷新老化时间. 如果不存在, 则新增表项
- MAC 地址表还有 vlan 标识
