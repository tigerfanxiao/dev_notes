# 工具
### ifconfig 安装
Centos 8 之后, 系统默认是没有`ifconfig` 命令的, 需要安装 net-tools
```shell
# centos
yum -y install net-tools 

# debian
apt-get install net-tools
apt-get install procps # top 命令
apt-get install iputils-ping # ping 命令


# 查询本机接口的 ip 地址
ifconfig
ifconfig eth1  # 查看某一个网口
# 可以查看接口收到和发出多少个包
ifconfig eth1 | grep inet

```

系统默认有IP命令可替换`ipconfig`命令
```python
# ip 命令可以取代 ipconfig, 有更多的功能
ip addr list

# 但是在系统重启后失效
ip addr add 192.168.1.50/24 dev eth1
# 配置静态路由, 重启后失效
ip route add 172.16.10.0/24 via 192.168.200.t0 dev eth1
```

### 主机名 hostname
合法的主机名的样式
```shell
# 其中 100-1 取内网中最后两段 IP 地址 100.1
es-madrid-node1-100-1.cainiao.com
```
非法主机名样式
```shell
# 以下是非法的主机名样式
rocky8.3 # 主机名的点后面不能直接跟数字, 或者以数字结尾
rocky_xiao.com # 主机名中不能使用下划线
```

注意： 非法的主机名会造成各种服务报错

修改 hostname
```shell
# 临时修改 hostname
hostname # 查看的hostname 是包含有 domain, 如果没有配置 domain 就是.local
# 显示简写的主机名
hostname -s # 看看除了 domain 之外的 hostname
hostname -i # 返回 hostname 的 ip 地址

#  永久修改 hostname
hostnamectl set-hostname rocky8.xiao.com
```
### `ping`
```python
ping -c 5 www.google.com # ping 5 个包
traceroute
```




```shell
# ip 命令可以取代 ipconfig, 有更多的功能
ip addr list # 
# 查看单个接口的信息
ip add show dev ens160 # dev好像是命令的一部分
ifconfig ens160
# 只是想查看接口的 ip 地址
ip add show dev ens160 | grep inet
ifconfig ens160 | grep inet


# 给接口添加 IP 地址, 但是在系统重启后失效
sudo ip link set ens192 down # 关闭接口
ip addr add 192.168.1.50/24 dev ens192 # 添加 ip 地址
ip addr show dev ens192 # 查看是否设置正确
sudo ip link set ens192 up # 打开接口
# 删除接口的 ip 地址
sudo ip link set ens192 down 
suod ip addr del 172.21.55.55/24 dev ens172
ip add show dev ens192

# 配置静态路由, 重启后失效
sudo ip route add 172.16.10.0/24 via 192.168.200.0 dev ens192
# 查看路由表
ip route list 

# 查看路由表 语言描述形式
ip route

# 查看路由表 表格样式
route 
# 删除静态路由
sudo ip route del 172.16.100.0/24 via 172.21.55.1 dev ens192

# 重启接口
sudo ifdown eth1
sudo ifup eth1 

# 
dig www.cisco.com # 查询 DNS 信息

host cisco.com  # DNS 解析 cisco.com 站点

ssh 192.168.1.1 # 使用系统用户去登录
ssh admin@192.168.1.1 -p 2222  # 如果遇到用户名里有@, 就不能用了
ssh -l join 192.168.1.1  # 常用



arp # 查看 arp 表
arp -s LOCAL_MACHINE 50:51:52:53:54:55  # 静态将 hostname 设置 mac 地址
```

### 网络配置的持久化
Persistent Networking Configuration

```shell
# 首先要看设备中网卡的名字
ip add
# 在 /etc/network/interfaces 中找到这个网卡
```

接口和路由信息的持久化在 `/etc/network/interfaces`
```shell
auto eth0 #  auto 表示重启后会自动配置这个接口
# iface eth0 inet dhcp # 开启 DHCP
iface eth0 inet static # 静态配置 IP 地址
      address 192.168.1.50  # 重启后 eth0 会被配置 ip 地址和下面的掩码
      netmask 255.255.255.0
	  # 配置静态路由
      up ip route add 172.16.10.0/24 via 192.168.1.25 dev eth2
      up ip route add 10.10.10.0/24 via 192.168.1.35 dev eth3

# 配置接口 dhcp
auto eth1
iface eth1 inet dhcp
```

在最新的 Debian 版本中, 接口配置信息被放在 `/etc/netplan/*.yaml` 中
```shell
sudo nano /etc/netplan/01-network-manager-all.yaml
```
内容可能如下
```shell
network:
	version: 2
	ethernets:
		ens18:
			dhcp4: true

```


如果你修改了文件配置 `sudo netplan apply` 使其生效
```shell
network:
  version: 2
  renderer: NetworkManager
  ethernets:
    ens192:
     dhcp4: no
     addresses: [172.21.55.10/24]
     gateway4: 172.21.55.1
     nameservers:
       addresses: [100.65.0.51,100.65.0.52]
```
如果你只是想查看当前的配置状态, 也可以使用 `cat /etc/sysconfig/network-scripts/ifcfg-<interface-name>命令
修改带个接口的配置 `nano /etc/netplan/ifcfg-ens33`

# dns

`/etc/hosts` 文件中保存了 ip 和域名的关系, 这里一个 ip 可以有多个域名. 
```shell
127.0.0.1 localhost snowblower # snowblower是自己添加的新的别名
```
查询DNS
```shell
vim /etc/resolv.conf
```

`/etc/resolv.conf` 保存着 DNS 的信息, 但是这个文件是基于放在 `/etc/resolvconf/resolv.conf.d/` 文件夹中文件动态生成的. 每次重启系统或者网络服务, 这个文件都会被重新生成一次. 也可以通过下面的命令手动生成
```shell
# 手动生成 /etc/resolv.conf 
sudo resolvconf -u 
```
增加 DNS 服务器
在`/etc/resolvconf/resolv.conf.d` 增加 `nameserver 127.0.1.1 nameserver 10.8.8.8` 才能修改 DNS 的配置

```shell
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 127.0.1.1
nameserver 10.8.8.8
~                                                                         
~                                                                         
~ 
"/etc/resolv.conf"
```

也可以通过产看systemd的软连接来查看DNS 站点配置
```shell
cat /run/systemd/resolve/resolv.conf # 这是/etc/reolv.conf 的软连接
```
重启网络服务
在配置为新的 IP 地址, 网关, 或者添加新的网卡等操作后, 都需要重启这个系统的网络服务
```shell
sudo service networking restart
sudo systemctl restart networking
```


# Routing table

```shell
netstat -i # 显示本地所有连接的统计信息
netstat -r # 显示路由表

# 查看这个机器上的程序, 相应的进程号, 端口号 
netstat -tulnp 
```


# Centos7

```shell
vim /etc/sysconfig/network-scripts/ifcfg-eno2

# 修改内容 IP 地址
IPADDR=172.20.0.102

# 重启网口
service network restart
```